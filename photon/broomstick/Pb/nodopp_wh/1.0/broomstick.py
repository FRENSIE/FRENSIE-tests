#!/usr/bin/python
import sys, os
from optparse import *
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
from broomstick_simulation import runBroomstickSimulation
import PyFrensie.Utility as Utility
import PyFrensie.MonteCarlo as MonteCarlo

if __name__ == "__main__":
    
    # Parse the command line options
    parser = OptionParser()
    parser.add_option("--threads", type="int", dest="threads", default=1,
                      help="the number of threads to use")
    parser.add_option("--db_path", type="string", dest="db_path",
                      help="the database name (with extension)")
    parser.add_option("--sim_name", type="string", dest="sim_name", default="sphere",
                      help="the simulation name")
    parser.add_option("--log_file", type="string", dest="log_file",
                      help="the file that will be used for logging")
    parser.add_option("--num_particles", type="float", dest="num_particles", default=1e3,
                      help="the number of particles to run")
    options,args = parser.parse_args()

    if options.db_path is None:
        print "The database path must be specified!"
        sys.exit(1)

    energy_bins = [0.001, 0.002998, 0.004996, 0.006994, 0.008992, 0.01099, 
                   0.012988, 0.014986, 0.016984, 0.018982, 0.02098, 0.022978, 
                   0.024976, 0.026974, 0.028972, 0.03097, 0.032968, 0.034966, 
                   0.036964, 0.038962, 0.04096, 0.042958, 0.044956, 0.046954, 
                   0.048952, 0.05095, 0.052948, 0.054946, 0.056944, 0.058942, 
                   0.06094, 0.062938, 0.064936, 0.066934, 0.068932, 0.07093, 
                   0.0730385, 0.0730395, 0.0752495, 0.0752505, 0.076924, 0.078922, 
                   0.08092, 0.0847395, 0.0847405, 0.0852349, 0.0852359, 0.0856948, 
                   0.0856958, 0.0858005, 0.0858015, 0.0875335, 0.0875345, 0.0876552, 
                   0.0876562, 0.0878543, 0.0878553, 0.087877, 0.087878, 0.0881786, 
                   0.0881796, 0.0882019, 0.0882029, 0.0882607, 0.0882617, 0.0882635, 
                   0.0882645, 0.0882825, 0.0882835, 0.0882842, 0.0882852, 0.09091, 
                   0.092908, 0.094906, 0.096904, 0.098902, 0.1009, 0.102898, 
                   0.104896, 0.106894, 0.108892, 0.11089, 0.112888, 0.114886, 
                   0.116884, 0.118882, 0.12088, 0.122878, 0.124876, 0.126874, 
                   0.128872, 0.13087, 0.132868, 0.134866, 0.136864, 0.138862, 
                   0.14086, 0.142858, 0.144856, 0.146854, 0.148852, 0.15085, 
                   0.152848, 0.154846, 0.156844, 0.158842, 0.16084, 0.162838, 
                   0.164836, 0.166834, 0.168832, 0.17083, 0.172828, 0.174826, 
                   0.176824, 0.178822, 0.18082, 0.182818, 0.184816, 0.186814, 
                   0.188812, 0.19081, 0.192808, 0.194806, 0.196804, 0.198802, 
                   0.2008, 0.202798, 0.204796, 0.206794, 0.208792, 0.21079, 
                   0.212788, 0.214786, 0.216784, 0.218782, 0.22078, 0.222778, 
                   0.224776, 0.226774, 0.228772, 0.23077, 0.232768, 0.234766, 
                   0.236764, 0.238762, 0.24076, 0.242758, 0.244756, 0.246754, 
                   0.248752, 0.25075, 0.252748, 0.254746, 0.256744, 0.258742, 
                   0.26074, 0.262738, 0.264736, 0.266734, 0.268732, 0.27073, 
                   0.272728, 0.274726, 0.276724, 0.278722, 0.28072, 0.282718, 
                   0.284716, 0.286714, 0.288712, 0.29071, 0.292708, 0.294706, 
                   0.296704, 0.298702, 0.3007, 0.302698, 0.304696, 0.306694, 
                   0.308692, 0.31069, 0.312688, 0.314686, 0.316684, 0.318682, 
                   0.32068, 0.322678, 0.324676, 0.326674, 0.328672, 0.33067, 
                   0.332668, 0.334666, 0.336664, 0.338662, 0.34066, 0.342658, 
                   0.344656, 0.346654, 0.348652, 0.35065, 0.352648, 0.354646, 
                   0.356644, 0.358642, 0.36064, 0.362638, 0.364636, 0.366634, 
                   0.368632, 0.37063, 0.372628, 0.374626, 0.376624, 0.378622, 
                   0.38062, 0.382618, 0.384616, 0.386614, 0.388612, 0.39061, 
                   0.392608, 0.394606, 0.396604, 0.398602, 0.4006, 0.402598, 
                   0.404596, 0.406594, 0.408592, 0.41059, 0.412588, 0.414586, 
                   0.416584, 0.418582, 0.42058, 0.422578, 0.424576, 0.426574, 
                   0.428572, 0.43057, 0.432568, 0.434566, 0.436564, 0.438562, 
                   0.44056, 0.442558, 0.444556, 0.446554, 0.448552, 0.45055, 
                   0.452548, 0.454546, 0.456544, 0.458542, 0.46054, 0.462538, 
                   0.464536, 0.466534, 0.468532, 0.47053, 0.472528, 0.474526, 
                   0.476524, 0.478522, 0.48052, 0.482518, 0.484516, 0.486514, 
                   0.488512, 0.49051, 0.492508, 0.494506, 0.496504, 0.498502, 
                   0.5005, 0.502498, 0.504496, 0.506494, 0.508492, 0.51049, 
                   0.512488, 0.514486, 0.516484, 0.518482, 0.52048, 0.522478, 
                   0.524476, 0.526474, 0.528472, 0.53047, 0.532468, 0.534466, 
                   0.536464, 0.538462, 0.54046, 0.542458, 0.544456, 0.546454, 
                   0.548452, 0.55045, 0.552448, 0.554446, 0.556444, 0.558442, 
                   0.56044, 0.562438, 0.564436, 0.566434, 0.568432, 0.57043, 
                   0.572428, 0.574426, 0.576424, 0.578422, 0.58042, 0.582418, 
                   0.584416, 0.586414, 0.588412, 0.59041, 0.592408, 0.594406, 
                   0.596404, 0.598402, 0.6004, 0.602398, 0.604396, 0.606394, 
                   0.608392, 0.61039, 0.612388, 0.614386, 0.616384, 0.618382, 
                   0.62038, 0.622378, 0.624376, 0.626374, 0.628372, 0.63037, 
                   0.632368, 0.634366, 0.636364, 0.638362, 0.64036, 0.642358, 
                   0.644356, 0.646354, 0.648352, 0.65035, 0.652348, 0.654346, 
                   0.656344, 0.658342, 0.66034, 0.662338, 0.664336, 0.666334, 
                   0.668332, 0.67033, 0.672328, 0.674326, 0.676324, 0.678322, 
                   0.68032, 0.682318, 0.684316, 0.686314, 0.688312, 0.69031, 
                   0.692308, 0.694306, 0.696304, 0.698302, 0.7003, 0.702298, 
                   0.704296, 0.706294, 0.708292, 0.71029, 0.712288, 0.714286, 
                   0.716284, 0.718282, 0.72028, 0.722278, 0.724276, 0.726274, 
                   0.728272, 0.73027, 0.732268, 0.734266, 0.736264, 0.738262, 
                   0.74026, 0.742258, 0.744256, 0.746254, 0.748252, 0.75025, 
                   0.752248, 0.754246, 0.756244, 0.758242, 0.76024, 0.762238, 
                   0.764236, 0.766234, 0.768232, 0.77023, 0.772228, 0.774226, 
                   0.776224, 0.778222, 0.78022, 0.782218, 0.784216, 0.786214, 
                   0.788212, 0.79021, 0.792208, 0.794206, 0.796204, 0.798202, 
                   0.8002, 0.802198, 0.804196, 0.806194, 0.808192, 0.81019, 
                   0.812188, 0.814186, 0.816184, 0.818182, 0.82018, 0.822178, 
                   0.824176, 0.826174, 0.828172, 0.83017, 0.832168, 0.834166, 
                   0.836164, 0.838162, 0.84016, 0.842158, 0.844156, 0.846154, 
                   0.848152, 0.85015, 0.852148, 0.854146, 0.856144, 0.858142, 
                   0.86014, 0.862138, 0.864136, 0.866134, 0.868132, 0.87013, 
                   0.872128, 0.874126, 0.876124, 0.878122, 0.88012, 0.882118, 
                   0.884116, 0.886114, 0.888112, 0.89011, 0.892108, 0.894106, 
                   0.896104, 0.898102, 0.9001, 0.902098, 0.904096, 0.906094, 
                   0.908092, 0.91009, 0.912088, 0.914086, 0.916084, 0.918082, 
                   0.92008, 0.922078, 0.924076, 0.926074, 0.928072, 0.93007, 
                   0.932068, 0.934066, 0.936064, 0.938062, 0.94006, 0.942058, 
                   0.944056, 0.946054, 0.948052, 0.95005, 0.952048, 0.954046, 
                   0.956044, 0.958042, 0.96004, 0.962038, 0.964036, 0.966034, 
                   0.968032, 0.97003, 0.972028, 0.974026, 0.976024, 0.978022, 
                   0.98002, 0.982018, 0.984016, 0.986014, 0.988012, 0.99001, 
                   0.992008, 0.994006, 0.996004, 0.998002, 1.0]

    # Run the simulation
    runBroomstickSimulation( options.sim_name,
                             options.db_path,
                             options.num_particles,
                             MonteCarlo.WH_INCOHERENT_MODEL,
                             1.0,
                             energy_bins,
                             options.threads,
                             options.log_file )
    
    
