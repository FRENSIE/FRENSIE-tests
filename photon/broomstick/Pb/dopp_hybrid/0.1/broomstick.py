#!/usr/bin/python
import sys, os
from optparse import *
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
from broomstick_simulation import runBroomstickSimulation
import PyFrensie.Utility as Utility
import PyFrensie.MonteCarlo as MonteCarlo

if __name__ == "__main__":
    
    # Parse the command line options
    parser = OptionParser()
    parser.add_option("--threads", type="int", dest="threads", default=1,
                      help="the number of threads to use")
    parser.add_option("--db_path", type="string", dest="db_path",
                      help="the database name (with extension)")
    parser.add_option("--sim_name", type="string", dest="sim_name", default="sphere",
                      help="the simulation name")
    parser.add_option("--log_file", type="string", dest="log_file",
                      help="the file that will be used for logging")
    parser.add_option("--num_particles", type="float", dest="num_particles", default=1e3,
                      help="the number of particles to run")
    options,args = parser.parse_args()

    if options.db_path is None:
        print "The database path must be specified!"
        sys.exit(1)

    # These bins were generated with the generate_bins.py script
    energy_bins = [0.001, 0.001198, 0.001396, 0.001594, 0.001792, 0.00199, 
                   0.002188, 0.002386, 0.002584, 0.002782, 0.00298, 0.003178, 
                   0.003376, 0.003574, 0.003772, 0.00397, 0.004168, 0.004366, 
                   0.004564, 0.004762, 0.00496, 0.005158, 0.005356, 0.005554, 
                   0.005752, 0.00595, 0.006148, 0.006346, 0.006544, 0.006742, 
                   0.00694, 0.007138, 0.007336, 0.007534, 0.007732, 0.00793, 
                   0.008128, 0.008326, 0.008524, 0.008722, 0.00892, 0.009118, 
                   0.009316, 0.009514, 0.009712, 0.00991, 0.010108, 0.010306, 
                   0.010504, 0.010702, 0.0109, 0.011098, 0.011296, 0.011494, 
                   0.011692, 0.01189, 0.012088, 0.012286, 0.012484, 0.012682, 
                   0.01288, 0.013078, 0.013276, 0.013474, 0.013672, 0.01387, 
                   0.014068, 0.014266, 0.014464, 0.014662, 0.01486, 0.015058, 
                   0.015256, 0.015454, 0.015652, 0.01585, 0.016048, 0.016246, 
                   0.016444, 0.016642, 0.01684, 0.017038, 0.017236, 0.017434, 
                   0.017632, 0.01783, 0.018028, 0.018226, 0.018424, 0.018622, 
                   0.01882, 0.019018, 0.019216, 0.019414, 0.019612, 0.01981, 
                   0.020008, 0.020206, 0.020404, 0.020602, 0.0208, 0.020998, 
                   0.021196, 0.021394, 0.021592, 0.02179, 0.021988, 0.022186, 
                   0.022384, 0.022582, 0.02278, 0.022978, 0.023176, 0.023374, 
                   0.023572, 0.02377, 0.023968, 0.024166, 0.024364, 0.024562, 
                   0.02476, 0.024958, 0.025156, 0.025354, 0.025552, 0.02575, 
                   0.025948, 0.026146, 0.026344, 0.026542, 0.02674, 0.026938, 
                   0.027136, 0.027334, 0.027532, 0.02773, 0.027928, 0.028126, 
                   0.028324, 0.028522, 0.02872, 0.028918, 0.029116, 0.029314, 
                   0.029512, 0.02971, 0.029908, 0.030106, 0.030304, 0.030502, 
                   0.0307, 0.030898, 0.031096, 0.031294, 0.031492, 0.03169, 
                   0.031888, 0.032086, 0.032284, 0.032482, 0.03268, 0.032878, 
                   0.033076, 0.033274, 0.033472, 0.03367, 0.033868, 0.034066, 
                   0.034264, 0.034462, 0.03466, 0.034858, 0.035056, 0.035254, 
                   0.035452, 0.03565, 0.035848, 0.036046, 0.036244, 0.036442, 
                   0.03664, 0.036838, 0.037036, 0.037234, 0.037432, 0.03763, 
                   0.037828, 0.038026, 0.038224, 0.038422, 0.03862, 0.038818, 
                   0.039016, 0.039214, 0.039412, 0.03961, 0.039808, 0.040006, 
                   0.040204, 0.040402, 0.0406, 0.040798, 0.040996, 0.041194, 
                   0.041392, 0.04159, 0.041788, 0.041986, 0.042184, 0.042382, 
                   0.04258, 0.042778, 0.042976, 0.043174, 0.043372, 0.04357, 
                   0.043768, 0.043966, 0.044164, 0.044362, 0.04456, 0.044758, 
                   0.044956, 0.045154, 0.045352, 0.04555, 0.045748, 0.045946, 
                   0.046144, 0.046342, 0.04654, 0.046738, 0.046936, 0.047134, 
                   0.047332, 0.04753, 0.047728, 0.047926, 0.048124, 0.048322, 
                   0.04852, 0.048718, 0.048916, 0.049114, 0.049312, 0.04951, 
                   0.049708, 0.049906, 0.050104, 0.050302, 0.0505, 0.050698, 
                   0.050896, 0.051094, 0.051292, 0.05149, 0.051688, 0.051886, 
                   0.052084, 0.052282, 0.05248, 0.052678, 0.052876, 0.053074, 
                   0.053272, 0.05347, 0.053668, 0.053866, 0.054064, 0.054262, 
                   0.05446, 0.054658, 0.054856, 0.055054, 0.055252, 0.05545, 
                   0.055648, 0.055846, 0.056044, 0.056242, 0.05644, 0.056638, 
                   0.056836, 0.057034, 0.057232, 0.05743, 0.057628, 0.057826, 
                   0.058024, 0.058222, 0.05842, 0.058618, 0.058816, 0.059014, 
                   0.059212, 0.05941, 0.059608, 0.059806, 0.060004, 0.060202, 
                   0.0604, 0.060598, 0.060796, 0.060994, 0.061192, 0.06139, 
                   0.061588, 0.061786, 0.061984, 0.062182, 0.06238, 0.062578, 
                   0.062776, 0.062974, 0.063172, 0.06337, 0.063568, 0.063766, 
                   0.063964, 0.064162, 0.06436, 0.064558, 0.064756, 0.064954, 
                   0.065152, 0.06535, 0.065548, 0.065746, 0.065944, 0.066142, 
                   0.06634, 0.066538, 0.066736, 0.066934, 0.067132, 0.06733, 
                   0.067528, 0.067726, 0.067924, 0.068122, 0.06832, 0.068518, 
                   0.068716, 0.068914, 0.069112, 0.06931, 0.069508, 0.069706, 
                   0.069904, 0.070102, 0.0703, 0.070498, 0.070696, 0.070894, 
                   0.071092, 0.07129, 0.071488, 0.071686, 0.071884, 0.072082, 
                   0.07228, 0.072478, 0.072676, 0.0730385, 0.0730395, 0.07327, 
                   0.073468, 0.073666, 0.073864, 0.074062, 0.07426, 0.074458, 
                   0.074656, 0.074854, 0.0752495, 0.0752505, 0.075448, 0.075646, 
                   0.075844, 0.076042, 0.07624, 0.076438, 0.076636, 0.076834, 
                   0.077032, 0.07723, 0.077428, 0.077626, 0.077824, 0.078022, 
                   0.07822, 0.078418, 0.078616, 0.078814, 0.079012, 0.07921, 
                   0.079408, 0.079606, 0.079804, 0.080002, 0.0802, 0.080398, 
                   0.080596, 0.080794, 0.080992, 0.08119, 0.081388, 0.081586, 
                   0.081784, 0.081982, 0.08218, 0.082378, 0.082576, 0.082774, 
                   0.082972, 0.08317, 0.083368, 0.083566, 0.083764, 0.083962, 
                   0.08416, 0.084358, 0.0847402, 0.0847412, 0.084952, 0.0852349, 
                   0.0852359, 0.0856948, 0.0856958, 0.0858005, 0.0858015, 0.085942, 
                   0.08614, 0.086338, 0.086536, 0.086734, 0.086932, 0.08713, 
                   0.087328, 0.0875335, 0.0875345, 0.0876552, 0.0876562, 0.0878543, 
                   0.0878553, 0.087877, 0.087878, 0.087922, 0.0881786, 0.0881796, 
                   0.0882019, 0.0882029, 0.0882607, 0.0882617, 0.0882635, 0.0882645, 
                   0.0882825, 0.0882835, 0.0882842, 0.0882852, 0.088516, 0.088714, 
                   0.088912, 0.08911, 0.089308, 0.089506, 0.089704, 0.089902, 
                   0.0901, 0.090298, 0.090496, 0.090694, 0.090892, 0.09109, 
                   0.091288, 0.091486, 0.091684, 0.091882, 0.09208, 0.092278, 
                   0.092476, 0.092674, 0.092872, 0.09307, 0.093268, 0.093466, 
                   0.093664, 0.093862, 0.09406, 0.094258, 0.094456, 0.094654, 
                   0.094852, 0.09505, 0.095248, 0.095446, 0.095644, 0.095842, 
                   0.09604, 0.096238, 0.096436, 0.096634, 0.096832, 0.09703, 
                   0.097228, 0.097426, 0.097624, 0.097822, 0.09802, 0.098218, 
                   0.098416, 0.098614, 0.098812, 0.09901, 0.099208, 0.099406, 
                   0.099604, 0.099802, 0.1]
    
    # Run the simulation
    runBroomstickSimulation( options.sim_name,
                             options.db_path,
                             options.num_particles,
                             MonteCarlo.DECOUPLED_HALF_PROFILE_DB_HYBRID_INCOHERENT_MODEL,
                             0.1,
                             energy_bins,
                             options.threads,
                             options.log_file )
    
    
